# ç®¡ç†å‘˜åŠŸèƒ½å®ç°æŒ‡å—

æœ¬æ–‡æ¡£ä¸ºå¼€å‘è€…æä¾›å½±é™¢ç®¡ç†å‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜åŠŸèƒ½çš„å®ç°æŒ‡å—ã€‚æ‰€æœ‰æ¡†æ¶ä»£ç å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¼€å‘è€…åªéœ€è¦åœ¨æŒ‡å®šçš„æ–¹æ³•ä¸­å¡«å†™å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/main/java/com/example/mysqltext/
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ SystemAdminController.java     # ç³»ç»Ÿç®¡ç†å‘˜æ§åˆ¶å™¨ï¼ˆå·²åˆ›å»ºæ¡†æ¶ï¼‰
â”‚   â””â”€â”€ CinemaAdminController.java     # å½±é™¢ç®¡ç†å‘˜æ§åˆ¶å™¨ï¼ˆå·²åˆ›å»ºæ¡†æ¶ï¼‰
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ SystemAdminService.java        # ç³»ç»Ÿç®¡ç†å‘˜æœåŠ¡ï¼ˆå·²åˆ›å»ºæ¡†æ¶ï¼‰
â”‚   â””â”€â”€ CinemaAdminService.java        # å½±é™¢ç®¡ç†å‘˜æœåŠ¡ï¼ˆå·²åˆ›å»ºæ¡†æ¶ï¼‰
â””â”€â”€ util/
    â””â”€â”€ AdminAuthUtil.java             # æƒé™éªŒè¯å·¥å…·ï¼ˆå·²åˆ›å»ºæ¡†æ¶ï¼‰
```

## ğŸ¯ å®ç°ç›®æ ‡

### ç³»ç»Ÿç®¡ç†å‘˜åŠŸèƒ½
- ç³»ç»Ÿç»Ÿè®¡å’Œæ•°æ®åˆ†æ
- ç”¨æˆ·ç®¡ç†
- ç³»ç»Ÿç»´æŠ¤å’Œé…ç½®
- å…¨å±€æŠ¥å‘Šç”Ÿæˆ

### å½±é™¢ç®¡ç†å‘˜åŠŸèƒ½
- å½±é™¢ä¿¡æ¯ç®¡ç†
- å½±å…ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- åœºæ¬¡ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- è¿è¥æŠ¥å‘Š
- ä¼šå‘˜ç®¡ç†
- å®æ—¶åº§ä½ç›‘æ§

## ğŸ”§ å®ç°æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šäº†è§£ç°æœ‰æ•°æ®åº“ç»“æ„

åœ¨å¼€å§‹å®ç°ä¹‹å‰ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹æ–‡ä»¶äº†è§£æ•°æ®åº“ç»“æ„ï¼š
- `init.sql` - æ•°æ®åº“è¡¨ç»“æ„
- `stored_procedures_documentation.md` - å­˜å‚¨è¿‡ç¨‹æ–‡æ¡£
- `triggers_documentation.md` - è§¦å‘å™¨æ–‡æ¡£

### ç¬¬äºŒæ­¥ï¼šå®ç°æƒé™éªŒè¯ï¼ˆAdminAuthUtil.javaï¼‰

**ä¼˜å…ˆçº§ï¼šé«˜** - è¿™æ˜¯æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½çš„åŸºç¡€

#### éœ€è¦å®ç°çš„æ–¹æ³•ï¼š

1. **getCurrentUser(HttpServletRequest request)**
   ```java
   // TODO: ä»sessionæˆ–tokenè·å–å½“å‰ç”¨æˆ·
   // å»ºè®®å®ç°æ–¹å¼ï¼š
   // 1. ä»Sessionè·å–ç”¨æˆ·ID
   // 2. è°ƒç”¨UserServiceè·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
   // 3. éªŒè¯ç”¨æˆ·çŠ¶æ€æ˜¯å¦æœ‰æ•ˆ
   ```

2. **validateSystemAdmin(HttpServletRequest request)**
   ```java
   // TODO: éªŒè¯ç³»ç»Ÿç®¡ç†å‘˜æƒé™
   // å®ç°è¦ç‚¹ï¼š
   // 1. è·å–å½“å‰ç”¨æˆ·
   // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
   // 3. å¯ä»¥æ·»åŠ æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
   ```

3. **validateCinemaAdmin(HttpServletRequest request, Integer cinemaId)**
   ```java
   // TODO: éªŒè¯å½±é™¢ç®¡ç†å‘˜æƒé™
   // å®ç°è¦ç‚¹ï¼š
   // 1. è·å–å½“å‰ç”¨æˆ·
   // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
   // 3. å¦‚æœæŒ‡å®šå½±é™¢IDï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰è¯¥å½±é™¢ç®¡ç†æƒé™
   ```

### ç¬¬ä¸‰æ­¥ï¼šå®ç°ç³»ç»Ÿç®¡ç†å‘˜æœåŠ¡ï¼ˆSystemAdminService.javaï¼‰

#### æ ¸å¿ƒæ–¹æ³•å®ç°æŒ‡å—ï¼š

1. **generateSalesReport(String startDate, String endDate)**
   ```java
   // TODO: è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ Manage_System
   // å‚è€ƒ stored_procedures_documentation.md
   // å®ç°æ­¥éª¤ï¼š
   // 1. éªŒè¯æ—¥æœŸæ ¼å¼å’ŒèŒƒå›´
   // 2. è°ƒç”¨å­˜å‚¨è¿‡ç¨‹è·å–é”€å”®æ•°æ®
   // 3. æ ¼å¼åŒ–è¿”å›ç»“æœ
   ```

2. **getMoviePerformanceStats(String startDate, String endDate)**
   ```java
   // TODO: è·å–ç”µå½±è¡¨ç°ç»Ÿè®¡
   // å¯ä»¥ä½¿ç”¨çš„æ•°æ®è¡¨ï¼š
   // - Movieï¼ˆç”µå½±ä¿¡æ¯ï¼‰
   // - Screeningï¼ˆåœºæ¬¡ä¿¡æ¯ï¼‰
   // - Orderï¼ˆè®¢å•ä¿¡æ¯ï¼‰
   // - OrderTicketï¼ˆç¥¨åŠ¡ä¿¡æ¯ï¼‰
   ```

3. **getUserList(int page, int size, String searchKeyword)**
   ```java
   // TODO: åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨
   // å®ç°è¦ç‚¹ï¼š
   // 1. ä½¿ç”¨UserMapperè¿›è¡Œåˆ†é¡µæŸ¥è¯¢
   // 2. æ”¯æŒæŒ‰ç”¨æˆ·åã€é‚®ç®±æœç´¢
   // 3. è¿”å›ç”¨æˆ·åŸºæœ¬ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®
   ```

### ç¬¬å››æ­¥ï¼šå®ç°å½±é™¢ç®¡ç†å‘˜æœåŠ¡ï¼ˆCinemaAdminService.javaï¼‰

#### æ ¸å¿ƒæ–¹æ³•å®ç°æŒ‡å—ï¼š

1. **getCinemaInfo(Integer cinemaId)**
   ```java
   // TODO: è·å–å½±é™¢è¯¦ç»†ä¿¡æ¯
   // å®ç°æ­¥éª¤ï¼š
   // 1. ä½¿ç”¨CinemaMapper.findById()è·å–åŸºæœ¬ä¿¡æ¯
   // 2. å¯ä»¥æ·»åŠ å½±å…æ•°é‡ã€å½“æ—¥åœºæ¬¡ç­‰ç»Ÿè®¡ä¿¡æ¯
   ```

2. **addHall(Integer cinemaId, Hall hallData)**
   ```java
   // TODO: æ·»åŠ æ–°å½±å…
   // å®ç°æ­¥éª¤ï¼š
   // 1. éªŒè¯å½±å…æ•°æ®ï¼ˆåç§°ã€åº§ä½é…ç½®ç­‰ï¼‰
   // 2. æ£€æŸ¥å½±å…åç§°æ˜¯å¦é‡å¤
   // 3. æ’å…¥å½±å…è®°å½•
   // 4. åˆå§‹åŒ–åº§ä½é…ç½®
   ```

3. **addScreening(Integer cinemaId, Screening screeningData)**
   ```java
   // TODO: æ·»åŠ æ–°åœºæ¬¡
   // å®ç°æ­¥éª¤ï¼š
   // 1. éªŒè¯åœºæ¬¡æ•°æ®
   // 2. æ£€æŸ¥æ—¶é—´å†²çª
   // 3. éªŒè¯ç”µå½±å’Œå½±å…çš„æœ‰æ•ˆæ€§
   // 4. åˆ›å»ºåœºæ¬¡è®°å½•
   // 5. åˆå§‹åŒ–åœºæ¬¡åº§ä½çŠ¶æ€
   ```

### ç¬¬äº”æ­¥ï¼šå®ç°æ§åˆ¶å™¨å±‚

æ§åˆ¶å™¨å±‚çš„å®ç°ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯ï¼š
1. è°ƒç”¨æƒé™éªŒè¯
2. å‚æ•°éªŒè¯
3. è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•
4. è¿”å›ç»Ÿä¸€æ ¼å¼çš„å“åº”

#### ç¤ºä¾‹å®ç°æ¨¡å¼ï¼š
```java
@PostMapping("/api/admin/cinema/{cinemaId}/halls")
public ResponseEntity<?> addHall(
    @PathVariable Integer cinemaId,
    @RequestBody Hall hallData,
    HttpServletRequest request) {
    
    try {
        // 1. æƒé™éªŒè¯
        User admin = adminAuthUtil.validateCinemaAdmin(request, cinemaId);
        
        // 2. è°ƒç”¨æœåŠ¡å±‚
        Integer hallId = cinemaAdminService.addHall(cinemaId, hallData);
        
        // 3. è¿”å›ç»“æœ
        return ResponseEntity.ok(Map.of(
            "success", true,
            "message", "å½±å…æ·»åŠ æˆåŠŸ",
            "hallId", hallId
        ));
        
    } catch (Exception e) {
        return ResponseEntity.badRequest().body(Map.of(
            "success", false,
            "message", e.getMessage()
        ));
    }
}
```

## ğŸ“‹ å®ç°æ£€æŸ¥æ¸…å•

### æƒé™éªŒè¯æ¨¡å— (AdminAuthUtil.java)
- [ ] `getCurrentUser()` - ä»è¯·æ±‚è·å–å½“å‰ç”¨æˆ·
- [ ] `validateSystemAdmin()` - ç³»ç»Ÿç®¡ç†å‘˜æƒé™éªŒè¯
- [ ] `validateCinemaAdmin()` - å½±é™¢ç®¡ç†å‘˜æƒé™éªŒè¯
- [ ] `hasSystemAdminPermission()` - ç³»ç»Ÿç®¡ç†æƒé™æ£€æŸ¥
- [ ] `hasCinemaAdminPermission()` - å½±é™¢ç®¡ç†æƒé™æ£€æŸ¥

### ç³»ç»Ÿç®¡ç†å‘˜æœåŠ¡ (SystemAdminService.java)
- [ ] `generateSalesReport()` - ç”Ÿæˆé”€å”®æŠ¥å‘Š
- [ ] `getMoviePerformanceStats()` - ç”µå½±è¡¨ç°ç»Ÿè®¡
- [ ] `getCinemaPerformanceStats()` - å½±é™¢è¡¨ç°ç»Ÿè®¡
- [ ] `getSystemDataStats()` - ç³»ç»Ÿæ•°æ®ç»Ÿè®¡
- [ ] `performSystemCleanup()` - ç³»ç»Ÿæ¸…ç†
- [ ] `getUserList()` - è·å–ç”¨æˆ·åˆ—è¡¨
- [ ] `updateUserStatus()` - æ›´æ–°ç”¨æˆ·çŠ¶æ€
- [ ] `getSystemConfig()` - è·å–ç³»ç»Ÿé…ç½®
- [ ] `updateSystemConfig()` - æ›´æ–°ç³»ç»Ÿé…ç½®

### å½±é™¢ç®¡ç†å‘˜æœåŠ¡ (CinemaAdminService.java)
- [ ] `getCinemaInfo()` - è·å–å½±é™¢ä¿¡æ¯
- [ ] `updateCinemaInfo()` - æ›´æ–°å½±é™¢ä¿¡æ¯
- [ ] `getCinemaHalls()` - è·å–å½±å…åˆ—è¡¨
- [ ] `addHall()` - æ·»åŠ å½±å…
- [ ] `updateHall()` - æ›´æ–°å½±å…
- [ ] `deleteHall()` - åˆ é™¤å½±å…
- [ ] `getCinemaScreenings()` - è·å–åœºæ¬¡åˆ—è¡¨
- [ ] `addScreening()` - æ·»åŠ åœºæ¬¡
- [ ] `updateScreening()` - æ›´æ–°åœºæ¬¡
- [ ] `cancelScreening()` - å–æ¶ˆåœºæ¬¡
- [ ] `getCinemaReports()` - è·å–è¿è¥æŠ¥å‘Š
- [ ] `getCinemaMembers()` - è·å–ä¼šå‘˜åˆ—è¡¨
- [ ] `getScreeningSeats()` - è·å–åº§ä½çŠ¶æ€

### æ§åˆ¶å™¨å±‚
- [ ] SystemAdminController - æ‰€æœ‰APIæ¥å£å®ç°
- [ ] CinemaAdminController - æ‰€æœ‰APIæ¥å£å®ç°

## ğŸ” æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
1. ä¸ºæ¯ä¸ªæœåŠ¡æ–¹æ³•ç¼–å†™å•å…ƒæµ‹è¯•
2. æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œå’Œæƒé™éªŒè¯
3. æµ‹è¯•å¼‚å¸¸æƒ…å†µå¤„ç†

### é›†æˆæµ‹è¯•
1. æµ‹è¯•å®Œæ•´çš„APIè°ƒç”¨æµç¨‹
2. éªŒè¯æƒé™æ§åˆ¶æ˜¯å¦æ­£ç¡®
3. æµ‹è¯•æ•°æ®ä¸€è‡´æ€§

### æ‰‹åŠ¨æµ‹è¯•
1. ä½¿ç”¨Postmanæˆ–ç±»ä¼¼å·¥å…·æµ‹è¯•API
2. éªŒè¯å‰ç«¯é›†æˆ
3. æµ‹è¯•å¹¶å‘åœºæ™¯

## ğŸ“š å‚è€ƒèµ„æº

### æ•°æ®åº“ç›¸å…³
- `init.sql` - å®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„
- `stored_procedures_documentation.md` - å­˜å‚¨è¿‡ç¨‹ä½¿ç”¨è¯´æ˜
- `triggers_documentation.md` - è§¦å‘å™¨è¯´æ˜

### ç°æœ‰ä»£ç å‚è€ƒ
- `UserController.java` - ç”¨æˆ·ç®¡ç†APIå‚è€ƒ
- `CinemaController.java` - å½±é™¢APIå‚è€ƒ
- `OrderController.java` - è®¢å•å¤„ç†å‚è€ƒ
- `AuthController.java` - è®¤è¯æµç¨‹å‚è€ƒ

### æ¨¡å‹ç±»
- `User.java` - ç”¨æˆ·æ¨¡å‹
- `Cinema.java` - å½±é™¢æ¨¡å‹
- `Hall.java` - å½±å…æ¨¡å‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- `Screening.java` - åœºæ¬¡æ¨¡å‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- `Order.java` - è®¢å•æ¨¡å‹

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**
   - æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œéƒ½å¿…é¡»è¿›è¡Œæƒé™éªŒè¯
   - æ•æ„Ÿæ“ä½œéœ€è¦è®°å½•æ“ä½œæ—¥å¿—
   - è¾“å…¥å‚æ•°å¿…é¡»è¿›è¡ŒéªŒè¯å’Œæ¸…ç†

2. **æ•°æ®ä¸€è‡´æ€§**
   - æ¶‰åŠå¤šè¡¨æ“ä½œæ—¶è€ƒè™‘ä½¿ç”¨äº‹åŠ¡
   - åˆ é™¤æ“ä½œå‰æ£€æŸ¥å…³è”æ•°æ®
   - æ›´æ–°æ“ä½œè¦éªŒè¯æ•°æ®å®Œæ•´æ€§

3. **æ€§èƒ½è€ƒè™‘**
   - å¤§æ•°æ®é‡æŸ¥è¯¢ä½¿ç”¨åˆ†é¡µ
   - å¤æ‚ç»Ÿè®¡å¯ä»¥è€ƒè™‘ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹
   - é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®è€ƒè™‘ç¼“å­˜

4. **é”™è¯¯å¤„ç†**
   - æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
   - è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
   - ä¼˜é›…å¤„ç†å¼‚å¸¸æƒ…å†µ

## ğŸš€ å¼€å§‹å®ç°

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œå®ç°ï¼š

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®ç°æƒé™éªŒè¯æ¨¡å—ï¼ˆAdminAuthUtil.javaï¼‰
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå®ç°åŸºç¡€çš„CRUDæ“ä½œï¼ˆå½±é™¢ã€å½±å…ã€åœºæ¬¡ç®¡ç†ï¼‰
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå®ç°ç»Ÿè®¡å’ŒæŠ¥å‘ŠåŠŸèƒ½
4. **ç¬¬å››é˜¶æ®µ**ï¼šå®ç°é«˜çº§åŠŸèƒ½ï¼ˆç³»ç»Ÿæ¸…ç†ã€é…ç½®ç®¡ç†ç­‰ï¼‰
5. **ç¬¬äº”é˜¶æ®µ**ï¼šå®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
6. **ç¬¬å…­é˜¶æ®µ**ï¼šç¼–å†™æµ‹è¯•å’Œæ–‡æ¡£

æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œå»ºè®®è¿›è¡Œå……åˆ†çš„æµ‹è¯•å†è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

---

**ç¥æ‚¨å®ç°é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç°æœ‰ä»£ç æˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚**